---
phase: 07-cli-polish-and-distribution
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - autopilot/src/cli/wizard.ts
  - autopilot/src/cli/index.ts
autonomous: true

must_haves:
  truths:
    - "Running gsd-autopilot with no arguments launches an interactive setup wizard that collects PRD path, notification channel, and model profile"
    - "Wizard validates PRD path exists before proceeding"
    - "Wizard offers to save settings to .gsd-autopilot.json"
    - "After wizard completes, autopilot starts the run with the collected settings (no second invocation needed)"
    - "Wizard feels like npm init -- quick questions, sensible defaults, then go"
  artifacts:
    - path: "autopilot/src/cli/wizard.ts"
      provides: "Interactive setup wizard using @inquirer/prompts"
      exports: ["runSetupWizard"]
    - path: "autopilot/src/cli/index.ts"
      provides: "CLI that launches wizard when no --prd or --resume provided"
      contains: "runSetupWizard"
  key_links:
    - from: "autopilot/src/cli/index.ts"
      to: "autopilot/src/cli/wizard.ts"
      via: "import { runSetupWizard }"
      pattern: "import.*runSetupWizard"
    - from: "autopilot/src/cli/wizard.ts"
      to: "@inquirer/prompts"
      via: "import { input, select, confirm }"
      pattern: "import.*@inquirer/prompts"
---

<objective>
Create an interactive setup wizard for first-run experience and integrate it into the CLI as the no-args default behavior.

Purpose: Per user decision, when run without arguments the CLI should launch an interactive wizard (like `npm init`) rather than showing an error. This guides new users through their first run with sensible defaults.
Output: Wizard module, CLI integration that dispatches to wizard when no --prd/--resume provided.
</objective>

<execution_context>
@C:/Users/russw/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/russw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-cli-polish-and-distribution/07-RESEARCH.md
@.planning/phases/07-cli-polish-and-distribution/07-01-SUMMARY.md
@autopilot/src/cli/index.ts
@autopilot/src/types/config.ts
@autopilot/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create interactive setup wizard module</name>
  <files>
    autopilot/src/cli/wizard.ts
  </files>
  <action>
**1. Install @inquirer/prompts:**

Run `cd C:/GitHub/GetShitDone/get-shit-done/autopilot && npm install @inquirer/prompts` to add the dependency.

**2. Create `autopilot/src/cli/wizard.ts`:**

Export interface for wizard results:
```typescript
export interface WizardResult {
  prdPath: string;
  notify: 'console' | 'system' | 'teams' | 'slack';
  webhookUrl?: string;
  model: 'quality' | 'balanced' | 'budget';
  depth: 'quick' | 'standard' | 'comprehensive';
  savedConfig: boolean;
}
```

Implement `runSetupWizard(): Promise<WizardResult>`:

Use `@inquirer/prompts` (input, select, confirm). The wizard should feel like `npm init` per user decision -- quick, sensible defaults, then start.

**Step 1 - Welcome banner:**
Print a brief welcome message:
```
Welcome to GSD Autopilot!
Let's set up your autonomous build.
```

**Step 2 - PRD path (input):**
- Message: "Path to your PRD or idea document:"
- Default: "./idea.md"
- Validate: use `access(resolve(value))` to check file exists. Return descriptive error if not found: `File not found: ${value}. Enter a valid file path.`

**Step 3 - Notification channel (select):**
- Message: "How should we notify you when questions arise?"
- Choices:
  - { name: 'Console output (default)', value: 'console' }
  - { name: 'System notifications (OS toasts)', value: 'system' }
  - { name: 'Microsoft Teams webhook', value: 'teams' }
  - { name: 'Slack webhook', value: 'slack' }
- Default: 'console'

**Step 4 - Webhook URL (input, conditional):**
If notify is 'teams' or 'slack', ask for webhook URL:
- Message: "Webhook URL:"
- Validate: check it starts with 'https://', return "URL must start with https://" if not

**Step 5 - Model profile (select):**
- Message: "Model profile:"
- Choices:
  - { name: 'Balanced (recommended)', value: 'balanced' }
  - { name: 'Quality (slower, more thorough)', value: 'quality' }
  - { name: 'Budget (faster, less thorough)', value: 'budget' }
- Default: 'balanced'

**Step 6 - Planning depth (select):**
- Message: "Planning depth:"
- Choices:
  - { name: 'Standard (recommended)', value: 'standard' }
  - { name: 'Quick (fewer plans, faster)', value: 'quick' }
  - { name: 'Comprehensive (more plans, thorough)', value: 'comprehensive' }
- Default: 'standard'

**Step 7 - Save config (confirm):**
- Message: "Save these settings to .gsd-autopilot.json for next time?"
- Default: true
- If yes: write `{ notify, model, depth, webhookUrl? }` to `.gsd-autopilot.json` in process.cwd() using `writeFile` with `JSON.stringify(config, null, 2)`. Do NOT save prdPath (it changes per project).

Return the WizardResult with the resolved absolute prdPath.

Handle Ctrl+C gracefully: wrap the wizard in try/catch. If the error is from user cancellation (ExitPromptError from @inquirer/prompts), print "Setup cancelled." and process.exit(0).
  </action>
  <verify>
Run `cd C:/GitHub/GetShitDone/get-shit-done/autopilot && npx tsc --noEmit` -- compiles clean.
Grep for `runSetupWizard` in `src/cli/wizard.ts` -- exported.
Grep for `@inquirer/prompts` in `src/cli/wizard.ts` -- imported.
Grep for `@inquirer/prompts` in `package.json` -- present in dependencies.
  </verify>
  <done>
Wizard module exports runSetupWizard that collects PRD path (validated), notification channel, webhook URL (conditional), model profile, depth, and save-config preference. Saves settings to .gsd-autopilot.json if requested. Handles Ctrl+C gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate wizard into CLI as no-args default behavior</name>
  <files>
    autopilot/src/cli/index.ts
  </files>
  <action>
**1. Add import:**
```typescript
import { runSetupWizard } from './wizard.js';
```

**2. Replace the no-args error** (from Plan 07-01) with wizard launch:

Currently (after 07-01):
```typescript
if (!options.resume && !options.prd) {
  console.error('Error: No input specified\n');
  // ...
  process.exit(1);
}
```

Replace with wizard dispatch:
```typescript
if (!options.resume && !options.prd) {
  // No args provided -- launch interactive setup wizard (per user decision)
  const wizardResult = await runSetupWizard();
  options.prd = wizardResult.prdPath;
  options.notify = wizardResult.notify;
  options.model = wizardResult.model;
  options.depth = wizardResult.depth;
  if (wizardResult.webhookUrl) {
    options.webhookUrl = wizardResult.webhookUrl;
  }
}
```

This way, after the wizard completes, the rest of the CLI action handler continues normally with the wizard-collected values. The user doesn't need to re-invoke the command.

**3. Ensure wizard results flow through to config loading:**

The wizard sets `options.prd`, `options.notify`, etc. which are already passed into `loadConfig(projectDir, { ... })`. Verify the wizard result fields map correctly to the config loader's CLI overrides object. The types should align since WizardResult uses the same literal union types as AutopilotConfig.

**4. Test the flow manually:**

After building (`npx tsc`), test:
- `node dist/cli/index.js` -- should launch wizard (won't run to completion without claude CLI but wizard UI should appear)
- `node dist/cli/index.js --prd ./idea.md` -- should skip wizard, run normally
- `node dist/cli/index.js --resume` -- should skip wizard, attempt resume
  </action>
  <verify>
Run `cd C:/GitHub/GetShitDone/get-shit-done/autopilot && npx tsc --noEmit` -- compiles clean.
Run `npx vitest run` -- all tests pass.
Grep for `runSetupWizard` in `src/cli/index.ts` -- present.
Grep for "No input specified" in `src/cli/index.ts` -- NOT present (replaced by wizard).
  </verify>
  <done>
CLI launches interactive wizard when run without --prd or --resume. Wizard collects settings and feeds them into the normal CLI flow. After wizard, autopilot starts immediately with collected settings. --prd and --resume still skip wizard and work as before.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` in autopilot/ -- full build succeeds
- `npx vitest run` -- all tests pass
- `node dist/cli/index.js` launches interactive wizard (no error)
- `node dist/cli/index.js --prd ./nonexistent.md` skips wizard, fails with PRD not found
- `node dist/cli/index.js --help` shows complete usage information
- @inquirer/prompts is in package.json dependencies
</verification>

<success_criteria>
- No-args invocation launches interactive wizard, not an error
- Wizard collects PRD path, notification, model, depth with sensible defaults
- Wizard validates PRD path exists before proceeding
- Wizard offers to save config to .gsd-autopilot.json
- After wizard, autopilot starts without requiring re-invocation
- --prd and --resume bypass wizard completely
- All existing tests pass with no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/07-cli-polish-and-distribution/07-02-SUMMARY.md`
</output>
