---
phase: 07-cli-polish-and-distribution
plan: 03
type: execute
wave: 3
depends_on: ["07-01", "07-02"]
files_modified:
  - autopilot/package.json
  - autopilot/tsconfig.json
  - autopilot/.gitattributes
autonomous: false

must_haves:
  truths:
    - "Package name is 'gsd-autopilot' and bin name is 'gsd-autopilot' (per user decision)"
    - "npm pack produces a tarball under 2MB"
    - "Package includes dist/**/*.js, dist/**/*.d.ts, dashboard/dist/, and example-adapter.js -- no source maps, no test files, no src/"
    - ".gitattributes enforces LF line endings for bin scripts (prevents shebang CRLF issue on Unix)"
    - "prepare script runs the full build (TypeScript + dashboard) before npm pack/publish"
    - "Shebang line in dist/cli/index.js is correct (#!/usr/bin/env node with LF ending)"
  artifacts:
    - path: "autopilot/package.json"
      provides: "npm-publishable package config with gsd-autopilot name, files whitelist, prepare script"
      contains: "gsd-autopilot"
    - path: "autopilot/tsconfig.json"
      provides: "Production-optimized TypeScript config (no source maps)"
      contains: "sourceMap"
    - path: "autopilot/.gitattributes"
      provides: "LF line ending enforcement for bin scripts"
      contains: "eol=lf"
  key_links:
    - from: "autopilot/package.json"
      to: "dist/cli/index.js"
      via: "bin field"
      pattern: "gsd-autopilot.*dist/cli/index.js"
    - from: "autopilot/package.json"
      to: "build pipeline"
      via: "prepare script calling npm run build"
      pattern: "prepare.*npm run build"
---

<objective>
Configure the autopilot package for npm distribution as `gsd-autopilot`, ensuring correct packaging, cross-platform compatibility, and sub-2MB size.

Purpose: The CLI must be installable via `npx gsd-autopilot --prd ./idea.md` (per user decision). This plan configures the package name, build pipeline, file whitelist, line ending safety, and verifies the packaged result.
Output: Production-ready package.json, optimized tsconfig, .gitattributes for cross-platform safety.
</objective>

<execution_context>
@C:/Users/russw/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/russw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-cli-polish-and-distribution/07-RESEARCH.md
@.planning/phases/07-cli-polish-and-distribution/07-01-SUMMARY.md
@.planning/phases/07-cli-polish-and-distribution/07-02-SUMMARY.md
@autopilot/package.json
@autopilot/tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure package.json, tsconfig, and .gitattributes for npm distribution</name>
  <files>
    autopilot/package.json
    autopilot/tsconfig.json
    autopilot/.gitattributes
  </files>
  <action>
**1. Update `autopilot/package.json`:**

Change the package name from `@gsd/autopilot` to `gsd-autopilot` (per user decision -- unscoped package for simpler npx invocation).

Update fields:
```json
{
  "name": "gsd-autopilot",
  "version": "0.1.0",
  "description": "Autonomous GSD workflow orchestrator -- turns a PRD into a built project",
  "type": "module",
  "engines": {
    "node": ">=20.0.0"
  },
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "types": "./dist/index.d.ts"
    }
  },
  "bin": {
    "gsd-autopilot": "./dist/cli/index.js",
    "gsd-dashboard": "./dist/server/standalone.js"
  },
  "files": [
    "dist/**/*.js",
    "dist/**/*.d.ts",
    "dashboard/dist/",
    "example-adapter.js",
    "!dist/**/*.test.*",
    "!dist/**/__tests__"
  ],
  "scripts": {
    "build": "tsc && cd dashboard && npm install && npm run build",
    "build:dashboard": "cd dashboard && npm install && npm run build",
    "prepare": "npm run build",
    "dev": "tsc --watch",
    "test": "vitest run",
    "test:watch": "vitest",
    "typecheck": "tsc --noEmit"
  }
}
```

Key changes:
- `name`: `@gsd/autopilot` -> `gsd-autopilot`
- `files`: Explicit whitelist with `dist/**/*.js` and `dist/**/*.d.ts` instead of `dist/`. This excludes `.js.map` files, test files, and `__tests__` directories. Dashboard dist included.
- `prepare`: Added script that runs full build before `npm pack` and `npm publish`
- Keep all existing dependencies, devDependencies, and optionalDependencies

**2. Update `autopilot/tsconfig.json`:**

Disable source maps for production build (reduces package size per research):

```json
{
  "compilerOptions": {
    "sourceMap": false,
    "declarationMap": false
  }
}
```

Change `sourceMap` from `true` to `false` and `declarationMap` from `true` to `false`.

**3. Create `autopilot/.gitattributes`:**

Per research Pitfall 1, enforce LF line endings for bin scripts to prevent shebang CRLF issues on Unix when published from Windows:

```
# Force LF line endings for all files in this package
* text=auto eol=lf

# Bin scripts MUST use LF (shebang fails with CRLF on Unix)
dist/cli/*.js text eol=lf
dist/server/*.js text eol=lf
```
  </action>
  <verify>
Run `cd C:/GitHub/GetShitDone/get-shit-done/autopilot && npx tsc --noEmit` -- compiles clean.
Run `npx vitest run` -- all tests pass.
Verify `package.json` has name `gsd-autopilot` (not `@gsd/autopilot`).
Verify `package.json` has `prepare` script.
Verify `tsconfig.json` has `"sourceMap": false`.
Verify `.gitattributes` exists and contains `eol=lf`.
  </verify>
  <done>
Package name is gsd-autopilot. Files whitelist excludes source maps, tests, and __tests__ directories. Prepare script ensures build before pack/publish. Source maps disabled for production. .gitattributes enforces LF for bin scripts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build, pack, and verify package size and contents</name>
  <files>
    autopilot/package.json
  </files>
  <action>
**1. Run full build:**
```bash
cd C:/GitHub/GetShitDone/get-shit-done/autopilot && npm run build
```

This runs `tsc` (TypeScript compilation) and builds the dashboard.

**2. Verify no source maps in dist/:**
```bash
find dist/ -name "*.map" | head -5
```
Should return nothing (source maps disabled).

**3. Verify shebang in dist/cli/index.js:**
```bash
head -1 dist/cli/index.js
```
Should show `#!/usr/bin/env node` with no trailing \r.

**4. Run npm pack --dry-run:**
```bash
npm pack --dry-run 2>&1
```
This lists all files that would be included in the tarball. Verify:
- dist/**/*.js files are included
- dist/**/*.d.ts files are included
- dashboard/dist/ files are included
- NO .map files
- NO .test.js files
- NO __tests__ directories
- example-adapter.js is included

**5. Run npm pack to create actual tarball:**
```bash
npm pack
```
Check the size of the resulting `gsd-autopilot-0.1.0.tgz` file. Must be under 2MB.

If over 2MB, investigate and trim:
- Check if dashboard/dist/ is too large (should be ~400KB)
- Check if dist/ contains unexpected files
- Consider if any large dependencies are bundled (they shouldn't be -- npm installs them separately)

**6. Test local installation from tarball:**
```bash
mkdir -p /tmp/gsd-test && cd /tmp/gsd-test
npm init -y
npm install C:/GitHub/GetShitDone/get-shit-done/autopilot/gsd-autopilot-0.1.0.tgz
npx gsd-autopilot --help
```

Verify:
- Installation completes without errors
- `npx gsd-autopilot --help` shows the full help text with all flags
- Bin script is executable

**7. Clean up:**
```bash
rm -rf /tmp/gsd-test
rm C:/GitHub/GetShitDone/get-shit-done/autopilot/gsd-autopilot-0.1.0.tgz
```

If the package is over 2MB, adjust the `files` field in package.json to further exclude unnecessary content and re-pack until under target.
  </action>
  <verify>
`npm pack --dry-run` shows only expected files (js, d.ts, dashboard/dist, example-adapter.js).
`npm pack` tarball is under 2MB.
`npx gsd-autopilot --help` works after local tarball install and shows all documented flags.
No .map files in packaged output.
Shebang line is correct (no CRLF).
  </verify>
  <done>
npm pack produces a tarball under 2MB containing only production files. Local tarball install works correctly. gsd-autopilot --help shows all flags. Shebang line is correct for cross-platform execution. Package is ready for npm publish.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify CLI end-to-end experience</name>
  <files>autopilot/dist/cli/index.js</files>
  <action>
Present the completed CLI to the user for end-to-end verification. This checkpoint confirms the full Phase 7 deliverable:
1. Interactive setup wizard when run without args
2. Preflight checks validating prerequisites
3. Actionable error messages with fix instructions
4. Enhanced --phases supporting comma-separated ranges
5. npm package ready for distribution as gsd-autopilot

Verification steps for the user:
1. Run `cd C:/GitHub/GetShitDone/get-shit-done/autopilot && npm run build`
2. Run `node dist/cli/index.js --help` -- verify all flags shown with examples
3. Run `node dist/cli/index.js` -- verify interactive wizard launches (Ctrl+C to exit)
4. Run `node dist/cli/index.js --resume` in a directory with no .planning/ -- verify "No previous run found" message
5. Run `npm pack --dry-run` -- verify package contents are correct (no maps, no tests)
6. Check package size: `npm pack` should produce less than 2MB tarball
  </action>
  <verify>User confirms all 6 verification steps pass by typing "approved".</verify>
  <done>Human has verified the end-to-end CLI experience is polished and the package is ready for distribution.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds (TypeScript + dashboard)
- `npm pack` produces tarball under 2MB named gsd-autopilot-0.1.0.tgz
- Packaged tarball installs correctly and `npx gsd-autopilot --help` works
- No source maps (.map) in package
- .gitattributes enforces LF for bin scripts
- Shebang line is correct for cross-platform execution
</verification>

<success_criteria>
- Package name is gsd-autopilot, bin name is gsd-autopilot
- npm pack produces < 2MB tarball with correct contents
- Local tarball install and `npx gsd-autopilot --help` works
- Cross-platform safety: LF line endings enforced for bin scripts
- Build pipeline: prepare script ensures build before pack/publish
- Human verification confirms end-to-end CLI experience is polished
</success_criteria>

<output>
After completion, create `.planning/phases/07-cli-polish-and-distribution/07-03-SUMMARY.md`
</output>
