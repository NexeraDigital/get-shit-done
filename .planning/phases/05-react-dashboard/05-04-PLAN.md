---
phase: 05-react-dashboard
plan: 04
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - autopilot/dashboard/src/pages/LogViewer.tsx
  - autopilot/dashboard/src/App.tsx
  - autopilot/package.json
  - autopilot/src/cli/index.ts
autonomous: false

must_haves:
  truths:
    - "Log viewer page shows live log stream with auto-scroll"
    - "Log viewer supports phase/step filtering via dropdowns"
    - "Log viewer supports text search to filter log entries"
    - "Dashboard builds successfully with vite build"
    - "Parent package.json build script includes dashboard build"
    - "localhost:3847 serves the dashboard SPA for all non-API routes"
    - "User can visually verify the complete dashboard works"
  artifacts:
    - path: "autopilot/dashboard/src/pages/LogViewer.tsx"
      provides: "Full log viewer page (DASH-18)"
      min_lines: 50
    - path: "autopilot/dashboard/dist/index.html"
      provides: "Production build output served by Express"
  key_links:
    - from: "autopilot/dashboard/src/pages/LogViewer.tsx"
      to: "autopilot/dashboard/src/store/index.ts"
      via: "useDashboardStore(s => s.logs) for log data"
      pattern: "useDashboardStore"
    - from: "autopilot/package.json"
      to: "autopilot/dashboard/package.json"
      via: "build:dashboard script that runs cd dashboard && npm run build"
      pattern: "dashboard"
    - from: "autopilot/src/cli/index.ts"
      to: "autopilot/src/server/index.ts"
      via: "dashboardDir option passed to ResponseServer constructor"
      pattern: "dashboardDir"
    - from: "autopilot/dashboard/src/App.tsx"
      to: "autopilot/dashboard/src/pages/LogViewer.tsx"
      via: "import and Route element for /logs path"
      pattern: "LogViewer"
---

<objective>
Build the LogViewer page with filtering and search, wire up the build integration, connect dashboardDir into the CLI bootstrap so the Express server actually serves the SPA, and verify the complete dashboard visually.

Purpose: The LogViewer is the final page completing the 4-page SPA. Build integration ensures the dashboard ships as pre-built static files in the npm package (FNDN-05). The dashboardDir wiring is critical -- without it, localhost:3847 returns 404 for all non-API routes because ResponseServer's SPA fallback has no directory to serve from. The visual verification confirms the entire dashboard works end-to-end.
Output: Complete 4-page dashboard SPA that builds and is served by the Express server at localhost:3847.
</objective>

<execution_context>
@C:/Users/russw/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/russw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-react-dashboard/05-RESEARCH.md

# Prior plan summaries for understanding what exists
@.planning/phases/05-react-dashboard/05-01-SUMMARY.md
@.planning/phases/05-react-dashboard/05-02-SUMMARY.md
@.planning/phases/05-react-dashboard/05-03-SUMMARY.md

# Server files to modify
@autopilot/src/cli/index.ts
@autopilot/src/server/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build LogViewer page with phase/step filtering and search</name>
  <files>
    autopilot/dashboard/src/pages/LogViewer.tsx
  </files>
  <action>
**LogViewer.tsx (DASH-18):**

Full-page log viewer with filtering, search, and auto-scroll. This is a more capable version of the LogStream component used in the overview -- it gets its own page with dedicated controls.

1. **Log data:** Subscribe to `useDashboardStore(s => s.logs)` for the full log array.

2. **Filter controls (top toolbar):**
   - **Phase filter:** A select dropdown listing unique phase numbers from the logs, plus "All phases" option. When selected, only show logs matching that phase number.
   - **Step filter:** A select dropdown listing unique step values from the logs, plus "All steps" option. Filter by step.
   - **Search:** A text input with placeholder "Search logs..." that filters log entries by message content (case-insensitive substring match). Use a local `searchTerm` state with onChange -- no debounce needed since filtering is client-side over max 500 entries.
   - **Clear filters** button that resets all filters

3. **Filtered logs:** Apply all active filters (phase AND step AND search) to produce the displayed log list. Use `useMemo` with dependencies on [logs, phaseFilter, stepFilter, searchTerm] to avoid recomputing on every render.

4. **Log display:** Reuse the same auto-scroll pattern from LogStream (Pattern 6 from research):
   - useRef on container div, useState for autoScroll (default true)
   - useEffect to scroll to bottom when filtered logs length changes and autoScroll is true
   - onScroll handler to detect manual scroll-up
   - Each log line: timestamp (HH:MM:SS), level badge (colored), [component], message
   - Color-code by level: debug=gray, info=default, warn=amber, error=red, fatal=red bold

5. **Stats bar:** Below the filters, show: total log count, filtered count (if filtering), and auto-scroll toggle button ("Auto-scroll: ON/OFF" that toggles the autoScroll state manually).

6. **Empty state:** If no logs at all, show "No log entries yet. Logs will appear here as the build runs."

Tailwind layout:
- Full height page: flex flex-col h-[calc(100vh-4rem)] (subtract header height)
- Filter toolbar: flex gap-3 items-center p-4 bg-white border-b
- Log container: flex-1 overflow-y-auto bg-gray-950 text-gray-300 font-mono text-xs p-4
- Stats bar: flex justify-between px-4 py-2 bg-gray-100 text-sm text-gray-600
  </action>
  <verify>
Run `cd autopilot/dashboard && npx tsc --noEmit` -- zero errors.
Run `cd autopilot/dashboard && npx vite build` -- succeeds.
  </verify>
  <done>LogViewer page shows full log stream with phase/step dropdown filters, text search, auto-scroll toggle, and log count stats. All filters compose (AND logic).</done>
</task>

<task type="auto">
  <name>Task 2: Wire build integration, App.tsx imports, and dashboardDir into CLI bootstrap</name>
  <files>
    autopilot/package.json
    autopilot/dashboard/src/App.tsx
    autopilot/src/cli/index.ts
  </files>
  <action>
**1. Update autopilot/package.json** to include dashboard build in the parent build pipeline:

- Add `"build:dashboard": "cd dashboard && npm install && npm run build"` script
- Update the existing `"build"` script to: `"tsc && cd dashboard && npm install && npm run build"`
  This ensures `npm run build` at the autopilot root produces both the server dist/ and dashboard/dist/.
- Verify the existing `"files"` array already contains `"dashboard/dist/"`. If not, add it.

**2. Update autopilot/dashboard/src/App.tsx** to replace Plan 02's inline placeholder components with imports from the real page files created in Plans 02, 03, and 04. This update is unconditional -- Plan 02 creates inline stubs, and this task replaces them with real imports:

- `import { Overview } from './pages/Overview'` (or default import, match the export style)
- `import { QuestionResponse } from './pages/QuestionResponse'` (or default import)
- `import { PhaseDetail } from './pages/PhaseDetail'` (or default import)
- `import { LogViewer } from './pages/LogViewer'` (or default import)

Remove any inline placeholder component definitions (e.g., `const QuestionResponse = () => <div>Coming soon</div>`). Keep the route structure unchanged -- only the imports change.

**3. Wire dashboardDir into autopilot/src/cli/index.ts** so ResponseServer serves the SPA:

Add these imports at the top of the file:
```typescript
import { fileURLToPath } from 'node:url';
import { dirname } from 'node:path';
```

Before the ResponseServer constructor call (around line 131), resolve the dashboard dist path:
```typescript
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const dashboardDir = join(__dirname, '..', '..', 'dashboard', 'dist');
```

This resolves from `autopilot/dist/cli/index.js` (the compiled output location) up to `autopilot/` then down to `dashboard/dist/`. The `join` import is already present (line 5).

Update the ResponseServer constructor to pass dashboardDir:
```typescript
const responseServer = new ResponseServer({
  stateStore,
  claudeService,
  orchestrator,
  logger,
  config,
  dashboardDir,
});
```

**4. Run the full build and verify:**
- Run `cd autopilot && npm run build` to verify the complete build pipeline works
- Confirm `autopilot/dashboard/dist/index.html` exists after build
- Confirm `autopilot/dist/` contains the compiled server TypeScript
  </action>
  <verify>
Run `cd autopilot && npm run build` -- completes successfully.
Verify `autopilot/dashboard/dist/index.html` exists.
Run `cd autopilot && npm test` -- existing server tests still pass.
Grep for `dashboardDir` in `autopilot/src/cli/index.ts` to confirm it is passed to ResponseServer.
  </verify>
  <done>Parent build script produces both server dist/ and dashboard dist/. App.tsx imports real page components (no stubs). CLI bootstrap passes dashboardDir to ResponseServer, enabling SPA serving at localhost:3847 for all non-API routes. Existing tests unaffected.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of complete dashboard</name>
  <files>autopilot/dashboard/src</files>
  <action>
Start the dashboard dev server and verify all 4 pages render correctly.

What was built: Complete 4-page React dashboard SPA with real-time SSE updates, question response flow, phase detail views, and log viewer with filtering. Built with React 19, Vite 7, Zustand 5, Tailwind CSS v4, and React Router 7. The Express server at localhost:3847 now receives dashboardDir so it will serve the SPA in production.

How to verify:
1. Start the dashboard dev server: `cd autopilot/dashboard && npm run dev`
2. The dev server runs on http://localhost:5173 (requires the Express API on port 3847 for data, but the UI structure can be verified without it)

Verify each page:
- **Overview (/)**: Progress bar, phase card section (clickable to navigate to phase detail), question badge, activity feed, collapsible log stream. Responsive layout (resize browser to see mobile single-column).
- **Question Response (/questions/test-id)**: Should show "Question not found" since no real questions exist -- this is correct behavior. Verify the page loads without errors.
- **Phase Detail (/phases/1)**: Should show "Phase not found" or empty state since no real data exists. Verify the page loads without errors.
- **Log Viewer (/logs)**: Should show empty state "No log entries yet". Verify filter dropdowns and search input render. Verify auto-scroll toggle button exists.

Check navigation:
- Header shows "GSD Autopilot" with connection indicator (red dot expected since no server)
- Nav links work: clicking "Overview" and "Logs" navigates correctly
- Phase card on overview links to phase detail page
- Browser back/forward buttons work

3. Verify production build: `cd autopilot/dashboard && npm run build` produces dist/index.html

Resume signal: Type "approved" if the dashboard looks correct, or describe any visual/functional issues.
  </action>
  <verify>User visually confirms all 4 pages render correctly, navigation works (including phase card click-through), and empty states display properly.</verify>
  <done>Dashboard passes visual verification -- all pages render, navigation works (including PhaseCard to PhaseDetail), empty states display correctly, and production build succeeds.</done>
</task>

</tasks>

<verification>
- `cd autopilot/dashboard && npx tsc --noEmit` passes with zero errors
- `cd autopilot/dashboard && npx vite build` produces dist/ with index.html + JS/CSS
- `cd autopilot && npm run build` completes the full build pipeline
- `autopilot/src/cli/index.ts` passes dashboardDir to ResponseServer constructor
- App.tsx imports real page components (Overview, QuestionResponse, PhaseDetail, LogViewer) -- no inline stubs
- All 4 pages render without errors
- LogViewer has phase filter, step filter, text search, and auto-scroll
- Build integration produces dashboard/dist/ ready for Express serving
</verification>

<success_criteria>
Complete 4-page dashboard SPA builds successfully, serves from Express via SPA fallback (dashboardDir wired into CLI bootstrap), and passes visual verification. All DASH requirements (10-18) and FNDN-05 are satisfied.
</success_criteria>

<output>
After completion, create `.planning/phases/05-react-dashboard/05-04-SUMMARY.md`
</output>
