---
phase: 05-react-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - autopilot/dashboard/src/pages/QuestionResponse.tsx
  - autopilot/dashboard/src/components/OptionCard.tsx
  - autopilot/dashboard/src/pages/PhaseDetail.tsx
  - autopilot/dashboard/src/components/StepProgress.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking a pending question opens a response page showing phase context, question markdown, option cards, and freeform text input"
    - "User can select options, type freeform text, change their mind, then submit -- all before clicking Submit (DASH-16)"
    - "After submission the form is disabled and shows Submitted state"
    - "Phase detail page shows step-by-step progress for any phase"
    - "Phase detail page shows commits, verification status, and filtered log entries for the selected phase"
  artifacts:
    - path: "autopilot/dashboard/src/pages/QuestionResponse.tsx"
      provides: "Question response page (DASH-15, DASH-16)"
      min_lines: 50
    - path: "autopilot/dashboard/src/components/OptionCard.tsx"
      provides: "Clickable option card component"
      min_lines: 15
    - path: "autopilot/dashboard/src/pages/PhaseDetail.tsx"
      provides: "Phase detail page (DASH-17)"
      min_lines: 40
    - path: "autopilot/dashboard/src/components/StepProgress.tsx"
      provides: "Step-by-step progress component for a phase"
      min_lines: 15
  key_links:
    - from: "autopilot/dashboard/src/pages/QuestionResponse.tsx"
      to: "autopilot/dashboard/src/api/client.ts"
      via: "submitAnswer() call on form submit"
      pattern: "submitAnswer"
    - from: "autopilot/dashboard/src/pages/QuestionResponse.tsx"
      to: "autopilot/dashboard/src/store/index.ts"
      via: "useDashboardStore to get questions list and find by ID"
      pattern: "useDashboardStore"
    - from: "autopilot/dashboard/src/pages/PhaseDetail.tsx"
      to: "autopilot/dashboard/src/store/index.ts"
      via: "useDashboardStore to get phases array and logs"
      pattern: "useDashboardStore"
    - from: "autopilot/dashboard/src/pages/PhaseDetail.tsx"
      to: "autopilot/dashboard/src/api/client.ts"
      via: "fetchPhases() for initial data"
      pattern: "fetchPhases"
---

<objective>
Build the QuestionResponse page for answering pending questions and the PhaseDetail page for inspecting individual phase progress.

Purpose: These two pages handle the two interactive use cases beyond the overview: responding to build questions (the core human-in-the-loop flow) and drilling into phase details. The QuestionResponse page is critical because it directly unblocks the build when questions are pending.
Output: Two fully functional pages with all sub-components, wired to the store and API.
</objective>

<execution_context>
@C:/Users/russw/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/russw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-react-dashboard/05-RESEARCH.md

# Plan 01 artifacts (types, store, API client)
@.planning/phases/05-react-dashboard/05-01-SUMMARY.md

# Server API contract for question submission
@autopilot/src/server/routes/api.ts
@autopilot/src/claude/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build QuestionResponse page with OptionCard component</name>
  <files>
    autopilot/dashboard/src/pages/QuestionResponse.tsx
    autopilot/dashboard/src/components/OptionCard.tsx
  </files>
  <action>
**OptionCard.tsx:**
- Props: `label: string, description: string, selected: boolean, disabled: boolean, onClick: () => void`
- Renders a clickable card showing the option label (bold) and description (secondary text)
- Selected state: blue border (border-blue-500), light blue background (bg-blue-50)
- Unselected state: gray border (border-gray-200), white background
- Disabled state: opacity-50 cursor-not-allowed
- Tailwind: p-4 rounded-lg border-2 cursor-pointer transition-colors, hover:border-blue-300 when not disabled

**QuestionResponse.tsx (DASH-15, DASH-16):**

Follow the Question Response Page Pattern from research closely. Key implementation details:

1. **Route params:** Use `useParams()` to get `questionId`. Use `useNavigate()` for back navigation.

2. **Find question:** Subscribe to `useDashboardStore(s => s.questions)` and find by ID. If not found, show a "Question not found or already answered" message with a link back to overview.

3. **Phase context:** If `question.phase` exists, show "Phase {question.phase}" and optionally `question.step` as context above the question.

4. **Question rendering:** The `question.questions` array contains multiple QuestionItem objects. For each QuestionItem:
   - Render `q.question` text using `react-markdown` (`<Markdown>{q.question}</Markdown>`) for markdown support
   - Render `q.header` as a section header above the options
   - Render `q.options` as a grid of OptionCard components (grid-cols-1 sm:grid-cols-2 gap-3)
   - Below the options, render a textarea for freeform text input with placeholder "Or type a custom response..."

5. **Local form state (DASH-16 - editable before submit):**
   - `answers: Record<string, string>` -- keyed by question text, value is selected option label
   - `freeform: Record<string, string>` -- keyed by question text, value is typed text
   - `submitting: boolean` -- true during API call
   - `submitted: boolean` -- true after successful submit
   - User can freely change selections and freeform text BEFORE clicking Submit. This IS the DASH-16 implementation -- editing happens before submission, not after (per research DASH-16 analysis).

6. **Submit handler:**
   - Merge answers and freeform: for each question, use freeform value if non-empty, otherwise use selected option
   - Call `submitAnswer(questionId, mergedAnswers)` from API client
   - On success: set submitted=true, disable all inputs
   - On error: show error message, keep form enabled for retry
   - Show loading state during submission ("Submitting..." on button)

7. **Post-submit state:**
   - All OptionCards disabled
   - Textarea disabled
   - Submit button shows "Submitted" with checkmark, disabled
   - Green success banner: "Response submitted. The build will continue."

Tailwind layout: max-w-3xl mx-auto p-6, each QuestionItem in a separate card (border rounded-lg p-6 mb-6), submit button at bottom (bg-blue-600 text-white px-6 py-3 rounded-lg)
  </action>
  <verify>
Run `cd autopilot/dashboard && npx tsc --noEmit` -- zero errors.
Run `cd autopilot/dashboard && npx vite build` -- succeeds.
  </verify>
  <done>QuestionResponse page renders question markdown, option cards, freeform input, and handles submit flow with pre-submit editing (DASH-16). Form disables after successful submission.</done>
</task>

<task type="auto">
  <name>Task 2: Build PhaseDetail page with StepProgress component</name>
  <files>
    autopilot/dashboard/src/pages/PhaseDetail.tsx
    autopilot/dashboard/src/components/StepProgress.tsx
  </files>
  <action>
**StepProgress.tsx (DASH-17 step-by-step progress):**
- Props: `steps: { discuss: PhaseStep, plan: PhaseStep, execute: PhaseStep, verify: PhaseStep }`
- Renders a horizontal stepper with 4 labeled steps: Discuss, Plan, Execute, Verify
- Each step shows as a circle connected by lines:
  - 'done': filled green circle with checkmark
  - 'idle': empty gray circle
  - Active step (matches the step name and is not 'idle' or 'done'): blue pulsing circle (animate-pulse)
- Step labels below each circle
- Tailwind: flex items-center justify-between, circles w-8 h-8 rounded-full, connecting lines h-0.5 flex-1 bg-gray-300 (bg-green-500 if previous step is done)

**PhaseDetail.tsx (DASH-17):**

1. **Route params:** Use `useParams()` to get `phaseNumber`. Parse to number.

2. **Find phase:** Subscribe to `useDashboardStore(s => s.phases)` and find by number. If not found, call `fetchPhases()` on mount (useEffect) to load data, then check again. If still not found after load, show "Phase not found" with link to overview.

3. **Page sections:**

   **Header:** Phase number and name (e.g., "Phase 3: Core Orchestrator"), status badge (same coloring as PhaseCard)

   **Step Progress:** Render StepProgress component with the phase's steps object

   **Timing:** Show startedAt and completedAt (if exists) as formatted dates, and elapsed time if both exist

   **Commits:** Show the `commits` array as a list of commit hash strings. Each commit displayed as monospace text. If empty, show "No commits recorded".

   **Verification Status:**
   - If steps.verify === 'done': green badge "Verified"
   - If steps.verify === 'idle': gray badge "Not verified yet"
   - Otherwise: blue badge "Verifying..."
   - Show gapIterations count if > 0 ("Gap iterations: {n}")

   **Filtered Logs:** Subscribe to `useDashboardStore(s => s.logs)` and filter logs where `log.phase === phaseNumber`. Render using the LogStream component (imported from components/LogStream -- created in Plan 02). If LogStream is not available yet (Plan 03 runs parallel to Plan 02), create a simple inline log list instead: map over filtered logs and render timestamp + level + message in monospace. Use the same dark terminal styling (bg-gray-950 text-gray-300 font-mono text-xs) with max-h-64 overflow-y-auto.

4. **Navigation:** Back link to overview at top of page.

Tailwind layout: max-w-4xl mx-auto p-6, sections separated by mt-8, cards with border rounded-lg p-6
  </action>
  <verify>
Run `cd autopilot/dashboard && npx tsc --noEmit` -- zero errors.
Run `cd autopilot/dashboard && npx vite build` -- succeeds.
  </verify>
  <done>PhaseDetail page shows step-by-step progress stepper, commits list, verification status with gap iteration count, timing info, and filtered phase logs. All data sourced from Zustand store.</done>
</task>

</tasks>

<verification>
- `cd autopilot/dashboard && npx tsc --noEmit` passes with zero errors
- `cd autopilot/dashboard && npx vite build` succeeds
- QuestionResponse page handles the full question answering flow
- OptionCard shows selected/unselected/disabled states correctly
- PhaseDetail page shows all DASH-17 requirements (steps, commits, logs, verification)
- StepProgress renders 4 steps with correct status indicators
- DASH-16 implemented as pre-submit editing (form is freely editable before submit)
</verification>

<success_criteria>
User can navigate to a question page and submit responses with option selection and freeform text, with full pre-submit editing capability. User can navigate to any phase detail page and see step progress, commits, verification status, and filtered logs.
</success_criteria>

<output>
After completion, create `.planning/phases/05-react-dashboard/05-03-SUMMARY.md`
</output>
