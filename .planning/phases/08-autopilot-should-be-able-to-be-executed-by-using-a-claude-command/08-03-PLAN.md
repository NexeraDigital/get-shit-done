---
phase: 08-autopilot-should-be-able-to-be-executed-by-using-a-claude-command
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - autopilot/workflows/gsd-autopilot/SKILL.md
  - autopilot/scripts/install-workflow.js
  - autopilot/package.json
autonomous: false

must_haves:
  truths:
    - "User can type /gsd:autopilot in Claude Code and the command is recognized"
    - "/gsd:autopilot launches autopilot in background and prints dashboard URL"
    - "/gsd:autopilot status shows current phase, progress %, and dashboard URL"
    - "/gsd:autopilot stop gracefully terminates the autopilot process"
    - "npm install copies SKILL.md and supporting files to ~/.claude/commands/gsd/"
    - "Arguments pass through: /gsd:autopilot --phases 3-5 runs npx gsd-autopilot --phases 3-5"
  artifacts:
    - path: "autopilot/workflows/gsd-autopilot/SKILL.md"
      provides: "Claude Code slash command definition with YAML frontmatter"
      contains: "name: gsd:autopilot"
      min_lines: 20
    - path: "autopilot/scripts/install-workflow.js"
      provides: "Postinstall script that copies workflow files to ~/.claude/commands/gsd/"
      min_lines: 20
    - path: "autopilot/package.json"
      provides: "Updated with postinstall script and workflow files in 'files' array"
      contains: "postinstall"
  key_links:
    - from: "autopilot/workflows/gsd-autopilot/SKILL.md"
      to: "autopilot/workflows/gsd-autopilot/launcher.js"
      via: "Bash command delegating to launcher.js"
      pattern: "node.*launcher\\.js"
    - from: "autopilot/scripts/install-workflow.js"
      to: "~/.claude/commands/gsd/"
      via: "fs.copyFile from workflows/ to commands directory"
      pattern: "\\.claude.*commands"
    - from: "autopilot/package.json"
      to: "autopilot/scripts/install-workflow.js"
      via: "postinstall script reference"
      pattern: "postinstall.*install-workflow"
---

<objective>
Create the Claude Code slash command skill file, the postinstall registration script, and update package.json. Then verify the full end-to-end flow.

Purpose: This wires everything together so that `/gsd:autopilot` is available in Claude Code sessions after the package is installed. The SKILL.md defines the command interface, the postinstall script handles distribution, and the checkpoint verifies it all works.

Output: SKILL.md command definition, install-workflow.js postinstall script, updated package.json.
</objective>

<execution_context>
@C:/Users/russw/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/russw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-autopilot-should-be-able-to-be-executed-by-using-a-claude-command/08-RESEARCH.md
@.planning/phases/08-autopilot-should-be-able-to-be-executed-by-using-a-claude-command/08-01-SUMMARY.md
@.planning/phases/08-autopilot-should-be-able-to-be-executed-by-using-a-claude-command/08-02-SUMMARY.md

# Reference for existing command structure
@C:/Users/russw/.claude/commands/gsd/new-project.md
# Reference for existing package.json
@autopilot/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SKILL.md slash command and postinstall registration</name>
  <files>
    autopilot/workflows/gsd-autopilot/SKILL.md
    autopilot/scripts/install-workflow.js
    autopilot/package.json
  </files>
  <action>
    **1. Create SKILL.md** at `autopilot/workflows/gsd-autopilot/SKILL.md`:

    YAML frontmatter following Claude Code command format (reference existing commands in `~/.claude/commands/gsd/`):
    ```yaml
    ---
    name: gsd:autopilot
    description: Launch, monitor, or stop GSD Autopilot for the current git branch
    argument-hint: "[status|stop|--prd path|--phases range|--notify channel]"
    allowed-tools:
      - Bash
    ---
    ```

    Note: Use `name: gsd:autopilot` (with colon, matching the `/gsd:` prefix pattern used by all other GSD commands like `gsd:new-project`, `gsd:plan-phase`).

    Body content should instruct Claude to execute a bash command that:
    1. Gets the current git branch: `git symbolic-ref --short HEAD 2>/dev/null || echo "detached"`
    2. Delegates to the launcher.js script with the branch name and user arguments

    The cleanest approach per user decision ("package copies/installs the workflow .md file into the GSD workflows directory during setup"): The install script copies ALL workflow files (SKILL.md, launcher.js, port-manager.js, pid-manager.js) to a subdirectory alongside the command. The SKILL.md uses a `__LAUNCHER_PATH__` placeholder that the postinstall replaces with the absolute installed path.

    Implementation:
    - Source SKILL.md contains `__LAUNCHER_PATH__` placeholder in the bash block
    - install-workflow.js reads SKILL.md, replaces `__LAUNCHER_PATH__` with the actual destination path of launcher.js, then writes to `~/.claude/commands/gsd/autopilot.md`
    - JS files (launcher.js, port-manager.js, pid-manager.js) are copied to `~/.claude/commands/gsd/gsd-autopilot/` subdirectory
    - The path in the installed SKILL.md becomes the absolute path to `~/.claude/commands/gsd/gsd-autopilot/launcher.js`

    The SKILL.md body should include:
    - Usage examples section showing all subcommands and arg patterns
    - Execution section with bash block: get branch, call launcher with `$ARGUMENTS`
    - Brief explanation of what the launcher handles (routing, port assignment, process management)

    **2. Create install-workflow.js** at `autopilot/scripts/install-workflow.js`:

    ESM module (.js) that:
    a. Determines the source directory: resolve from the script's own location using `import.meta.url` to find `../workflows/gsd-autopilot/` (this works both during development and from the installed npm package)
    b. Determines the destination: `path.join(os.homedir(), '.claude', 'commands', 'gsd')` for the SKILL.md, and `path.join(os.homedir(), '.claude', 'commands', 'gsd', 'gsd-autopilot')` subdirectory for the JS files
    c. Creates destination dirs with `{ recursive: true }`
    d. Copies JS files (launcher.js, port-manager.js, pid-manager.js) to the subdirectory
    e. Reads SKILL.md, replaces `__LAUNCHER_PATH__` with the absolute path to the installed launcher.js, writes as `autopilot.md` to the commands/gsd/ directory
    f. Prints "Installed /gsd:autopilot command to ~/.claude/commands/gsd/"
    g. Wraps everything in try/catch -- postinstall failures should NOT break npm install (print warning and exit 0)

    Important: The destination is `~/.claude/commands/gsd/` (NOT `~/.claude/skills/`) -- this matches the existing GSD command structure where all `/gsd:*` commands live.

    **3. Update package.json:**

    Add to `scripts`:
    ```json
    "postinstall": "node scripts/install-workflow.js"
    ```

    Add to `files` array (before the exclusion patterns):
    ```json
    "workflows/gsd-autopilot/"
    "scripts/install-workflow.js"
    ```

    This ensures the workflow files and install script are included in the npm package.
  </action>
  <verify>
    ```bash
    cd autopilot && node scripts/install-workflow.js
    ```
    Prints success message. Check that `~/.claude/commands/gsd/autopilot.md` exists and contains the resolved launcher path (no `__LAUNCHER_PATH__` placeholder remaining). Check that `~/.claude/commands/gsd/gsd-autopilot/launcher.js` exists.
  </verify>
  <done>
    SKILL.md defines /gsd:autopilot with proper YAML frontmatter and bash execution block. install-workflow.js copies all files to ~/.claude/commands/gsd/ with path resolution. package.json has postinstall script and includes workflow files in the npm package. Running install-workflow.js produces working command files in the expected locations.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify slash command end-to-end</name>
  <files>none</files>
  <action>
    Human verification of the complete /gsd:autopilot integration. All implementation is done in prior tasks -- this checkpoint verifies the full flow works interactively.

    What was built:
    - Port manager with deterministic branch-to-port hashing (Plan 01)
    - PID manager for process lifecycle tracking (Plan 02)
    - Launcher script with subcommand routing: launch/status/stop (Plan 02)
    - SKILL.md command definition installed to ~/.claude/commands/gsd/ (Plan 03 Task 1)
    - Postinstall script for npm package distribution (Plan 03 Task 1)
  </action>
  <verify>
    Steps for user to test:
    1. Open a new Claude Code session (or restart current one to pick up new commands)
    2. Type `/gsd:` and verify `autopilot` appears in the autocomplete menu
    3. Run `/gsd:autopilot status` -- should report "No autopilot running for branch 'main'" (or current branch)
    4. If you have an existing project with .planning/, run `/gsd:autopilot` -- should launch autopilot in background and print dashboard URL
    5. Run `/gsd:autopilot status` again -- should now show running status with phase/progress
    6. Run `/gsd:autopilot stop` -- should gracefully stop the autopilot
    7. Verify the dashboard URL was accessible while autopilot was running

    Resume signal: Type "approved" if the slash command works end-to-end, or describe any issues encountered.
  </verify>
  <done>
    User confirms /gsd:autopilot command appears in autocomplete, launch/status/stop subcommands all function correctly, background process spawns and is controllable, and dashboard is accessible at the assigned port.
  </done>
</task>

</tasks>

<verification>
1. `~/.claude/commands/gsd/autopilot.md` exists with valid YAML frontmatter (name: gsd:autopilot)
2. `~/.claude/commands/gsd/gsd-autopilot/launcher.js` exists and imports resolve correctly
3. `~/.claude/commands/gsd/gsd-autopilot/port-manager.js` exists
4. `~/.claude/commands/gsd/gsd-autopilot/pid-manager.js` exists
5. `autopilot/package.json` has postinstall script referencing install-workflow.js
6. `autopilot/package.json` files array includes workflows/ and scripts/
7. No `__LAUNCHER_PATH__` placeholder remaining in installed autopilot.md
</verification>

<success_criteria>
- /gsd:autopilot appears in Claude Code slash command autocomplete
- /gsd:autopilot launches background autopilot and prints dashboard URL
- /gsd:autopilot status reports current phase and progress
- /gsd:autopilot stop gracefully terminates the process
- npm postinstall correctly copies files to ~/.claude/commands/gsd/
- Arguments pass through: --prd, --phases, --notify all work
</success_criteria>

<output>
After completion, create `.planning/phases/08-autopilot-should-be-able-to-be-executed-by-using-a-claude-command/08-03-SUMMARY.md`
</output>
