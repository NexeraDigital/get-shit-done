---
phase: 03.2-add-sub-phase-support-to-orchestrator-and-dashboard
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - autopilot/dashboard/src/types/index.ts
  - autopilot/dashboard/src/components/PhaseCard.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard PhaseState type includes optional inserted and dependsOn fields matching server type"
    - "PhaseCard displays INSERTED badge/pill for phases with inserted: true"
    - "All phases (integer and decimal) count equally in progress counter"
    - "Dashboard builds without TypeScript errors"
  artifacts:
    - path: "autopilot/dashboard/src/types/index.ts"
      provides: "PhaseState with optional inserted and dependsOn fields"
      contains: "inserted"
    - path: "autopilot/dashboard/src/components/PhaseCard.tsx"
      provides: "INSERTED badge rendering for inserted phases"
      contains: "INSERTED"
  key_links:
    - from: "autopilot/dashboard/src/components/PhaseCard.tsx"
      to: "autopilot/dashboard/src/types/index.ts"
      via: "PhaseState.inserted field access for badge rendering"
      pattern: "phase\\.inserted"
---

<objective>
Mirror the `PhaseState` type changes from the server to the dashboard and add an INSERTED badge to the PhaseCard component for inserted/decimal phases.

Purpose: The dashboard types are intentionally duplicated (separate Vite project). When Plan 01 extends PhaseState on the server side, this plan mirrors those changes to the dashboard and updates PhaseCard to visually distinguish inserted phases.

Output: Updated dashboard types and PhaseCard with INSERTED badge.
</objective>

<execution_context>
@C:/Users/russw/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/russw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@autopilot/dashboard/src/types/index.ts
@autopilot/dashboard/src/components/PhaseCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Mirror PhaseState type changes to dashboard</name>
  <files>autopilot/dashboard/src/types/index.ts</files>
  <action>
Add two optional fields to the `PhaseState` type in the dashboard types file:

```typescript
export type PhaseState = {
  number: number;
  name: string;
  status: PhaseStatus;
  steps: {
    discuss: PhaseStep;
    plan: PhaseStep;
    execute: PhaseStep;
    verify: PhaseStep;
  };
  startedAt?: string;
  completedAt?: string;
  commits: CommitInfo[];
  gapIterations: number;
  inserted?: boolean;
  dependsOn?: string | null;
};
```

These fields are optional (`?`) for backwards compatibility -- existing serialized state without these fields will still parse correctly. The comment at the top of the file references the server source; ensure the fields are in the same order as the server's PhaseState interface.
  </action>
  <verify>cd autopilot/dashboard && npx tsc --noEmit</verify>
  <done>Dashboard PhaseState type matches server PhaseState with inserted and dependsOn optional fields.</done>
</task>

<task type="auto">
  <name>Task 2: Add INSERTED badge to PhaseCard</name>
  <files>autopilot/dashboard/src/components/PhaseCard.tsx</files>
  <action>
Update the `PhaseRow` component to display an "INSERTED" badge when `phase.inserted` is truthy.

In the `PhaseRow` function, inside the div that contains the phase number and name (the `flex items-center gap-2` div), add the INSERTED badge after the phase name span:

```tsx
<div className="flex items-center gap-2">
  <span className="text-xs font-mono text-gray-400">
    {padPhaseDisplay(phase.number)}
  </span>
  <span className={`text-sm font-medium ${isCurrent ? 'text-gray-900' : 'text-gray-700'}`}>
    {phase.name}
  </span>
  {phase.inserted && (
    <span className="rounded-full bg-purple-100 px-1.5 py-0.5 text-[9px] font-semibold text-purple-700 uppercase tracking-wide">
      inserted
    </span>
  )}
</div>
```

Style choices (Claude's discretion per CONTEXT.md):
- Purple color scheme (bg-purple-100, text-purple-700) to visually distinguish from status badges which use blue/green/red/yellow
- Smaller font size (text-[9px]) and uppercase to make it a subtle secondary label, not competing with the status badge on the right
- rounded-full pill shape consistent with the existing status badge styling

The progress counter already counts all phases equally via `phases.filter(p => p.status === 'completed').length` / `phases.length` -- no changes needed there since decimal phases are already included in the phases array.

Display approach (Claude's discretion): Flat list with visual distinction via the INSERTED badge (not nested under parent). This is simpler and the badge provides clear visual differentiation.
  </action>
  <verify>cd autopilot/dashboard && npx tsc --noEmit</verify>
  <done>PhaseCard displays a purple "INSERTED" pill badge next to the name of phases with inserted: true. Non-inserted phases show no badge. Progress counter counts all phases equally.</done>
</task>

</tasks>

<verification>
1. `cd autopilot/dashboard && npx tsc --noEmit` -- Dashboard TypeScript compiles with no errors
2. `cd autopilot && npm run build` -- Full project builds successfully (both server and dashboard)
3. Visual check: PhaseCard renders INSERTED badge only for phases with `inserted: true`
</verification>

<success_criteria>
- Dashboard PhaseState type mirrors server PhaseState with inserted and dependsOn optional fields
- PhaseCard shows INSERTED badge for inserted phases using purple pill styling
- All phases count equally in progress counter (no changes needed, existing logic sufficient)
- Dashboard compiles cleanly with no TypeScript errors
- Full project build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/03.2-add-sub-phase-support-to-orchestrator-and-dashboard/03.2-02-SUMMARY.md`
</output>
