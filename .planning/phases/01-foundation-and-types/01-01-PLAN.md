---
phase: 01-foundation-and-types
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - vitest.config.ts
  - src/index.ts
  - src/types/index.ts
  - src/types/state.ts
  - src/types/config.ts
  - src/types/log.ts
  - src/types/notification.ts
autonomous: true

must_haves:
  truths:
    - "Running npm install succeeds with zero errors"
    - "Running npm run build compiles all TypeScript with strict mode and produces dist/ output"
    - "All type definitions are importable from the package entry point"
    - "The project is configured as ESM-only with NodeNext module resolution"
  artifacts:
    - path: "package.json"
      provides: "npm package definition for @gsd/autopilot"
      contains: '"type": "module"'
    - path: "tsconfig.json"
      provides: "TypeScript strict ESM configuration"
      contains: '"module": "NodeNext"'
    - path: "vitest.config.ts"
      provides: "Test runner configuration"
      contains: "vitest"
    - path: "src/types/state.ts"
      provides: "AutopilotState, PhaseState, ErrorRecord, PendingQuestion types"
      exports: ["AutopilotState", "PhaseState", "ErrorRecord", "PendingQuestion"]
    - path: "src/types/config.ts"
      provides: "AutopilotConfig Zod schema and inferred type"
      exports: ["AutopilotConfigSchema", "AutopilotConfig"]
    - path: "src/types/log.ts"
      provides: "LogEntry and LogLevel types"
      exports: ["LogEntry", "LogLevel"]
    - path: "src/types/notification.ts"
      provides: "Notification and NotificationAdapter interface stubs for later phases"
      exports: ["Notification", "NotificationAdapter"]
    - path: "src/index.ts"
      provides: "Package entry point re-exporting public API"
  key_links:
    - from: "src/index.ts"
      to: "src/types/index.ts"
      via: "barrel re-export"
      pattern: "export.*from.*types"
    - from: "src/types/index.ts"
      to: "src/types/state.ts"
      via: "barrel re-export"
      pattern: "export.*from.*state"
    - from: "src/types/config.ts"
      to: "zod"
      via: "schema definition"
      pattern: "import.*from.*zod"
---

<objective>
Create the compilable TypeScript ESM project skeleton and shared type definitions for @gsd/autopilot.

Purpose: Every subsequent plan and phase depends on this project structure, build pipeline, and type system. This is the foundation that must exist before any logic can be written.
Output: A project that runs `npm run build` cleanly with strict TypeScript, producing ESM output with all shared types defined.
</objective>

<execution_context>
@C:\Users\russw\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\russw\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-and-types/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project skeleton with package.json, tsconfig.json, and vitest config</name>
  <files>package.json, tsconfig.json, vitest.config.ts, .gitignore</files>
  <action>
IMPORTANT: This project is being built inside the existing get-shit-done repo. The EXISTING package.json at root is for `get-shit-done-cc`. Do NOT overwrite it. Instead, create a NEW directory `autopilot/` at the repo root and build the @gsd/autopilot package there.

Create directory structure:
```
autopilot/
  package.json
  tsconfig.json
  vitest.config.ts
  src/
    index.ts
    types/
    state/
    logger/
    config/
```

**autopilot/package.json** -- Use the exact skeleton from 01-RESEARCH.md:
- name: "@gsd/autopilot" (per user decision)
- version: "0.1.0"
- type: "module" (FNDN-01: ESM-only)
- engines.node: ">=20.0.0" (per roadmap decision)
- exports: { ".": { import: "./dist/index.js", types: "./dist/index.d.ts" } }
- bin: { "gsd-autopilot": "./dist/cli/index.js" }
- scripts: build (tsc), dev (tsc --watch), test (vitest run), test:watch (vitest), typecheck (tsc --noEmit)
- dependencies: pino ^10.3.0, write-file-atomic ^7.0.0, zod ^4.0.0
- devDependencies: @types/node ^20.0.0, pino-pretty ^13.0.0, typescript ~5.9.0, vitest ^4.0.0

**autopilot/tsconfig.json** -- Use the exact config from 01-RESEARCH.md:
- target: ES2022, module: NodeNext, moduleResolution: NodeNext
- lib: ["ES2023"]
- outDir: dist, rootDir: src
- declaration: true, declarationMap: true, sourceMap: true
- strict: true, noUncheckedIndexedAccess: true, noImplicitOverride: true
- verbatimModuleSyntax: true (enforces import type syntax and .js extensions)
- include: ["src/**/*.ts"], exclude: ["node_modules", "dist", "dashboard"]

**autopilot/vitest.config.ts**:
```typescript
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    globals: true,
    environment: 'node',
  },
});
```

Run `npm install` in the autopilot/ directory to install all dependencies.
Run `npm run build` to verify TypeScript compiles (will need at least a minimal src/index.ts).

CRITICAL: All relative imports in .ts files MUST use .js extensions (e.g., `import { Foo } from './types/index.js'`). This is required by NodeNext module resolution and will cause runtime failures if omitted.
  </action>
  <verify>
Run from autopilot/ directory:
- `npm install` exits with code 0
- `npm run build` exits with code 0 and produces autopilot/dist/ directory
- `ls dist/` shows .js, .d.ts, and .js.map files
- `node -e "import('./dist/index.js').then(m => console.log(Object.keys(m)))"` runs without error
  </verify>
  <done>
autopilot/ directory exists with package.json, tsconfig.json, vitest.config.ts. npm install and npm run build both succeed. dist/ contains compiled ESM output.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared type definitions for state, config, log, and notification</name>
  <files>autopilot/src/types/state.ts, autopilot/src/types/config.ts, autopilot/src/types/log.ts, autopilot/src/types/notification.ts, autopilot/src/types/index.ts, autopilot/src/index.ts</files>
  <action>
Create the type definition files following the exact specifications from 01-RESEARCH.md. All types use TypeScript interfaces and enums. Config types use Zod schemas with z.infer<> for the TypeScript type.

**src/types/state.ts** -- Per CONTEXT.md locked decisions:
- AutopilotStatus: 'idle' | 'running' | 'waiting_for_human' | 'error' | 'complete'
- PhaseStep: 'idle' | 'discuss' | 'plan' | 'execute' | 'verify' | 'done'
- PhaseStatus: 'pending' | 'in_progress' | 'completed' | 'failed' | 'skipped'
- ErrorRecord: { timestamp, phase, step, message, truncatedOutput? } -- per user decision: error history in state file with timestamps, phase, step, truncated output
- PendingQuestion: { id, phase, step, questions, createdAt, answeredAt?, answers? } -- per user decision: pending questions survive restart
- PhaseState: { number, name, status, steps (discuss/plan/execute/verify each as PhaseStep), startedAt?, completedAt?, commits, gapIterations }
- AutopilotState: { status, currentPhase, currentStep, phases, pendingQuestions, errorHistory, startedAt, lastUpdatedAt }

Use the exact interfaces from 01-RESEARCH.md code examples. State granularity is phase+step (per research discretion recommendation).

**src/types/config.ts** -- Per CONTEXT.md locked decisions:
- Use Zod schema (AutopilotConfigSchema) with z.infer<> for the type
- Fields: notify (string, default 'console'), webhookUrl (url, optional), adapterPath (string, optional), port (number, default 3847), depth (enum, default 'standard'), model (enum, default 'balanced'), skipDiscuss (boolean, default false), skipVerify (boolean, default false), verbose (boolean, default false), quiet (boolean, default false)
- Config format is JSON only (.gsd-autopilot.json) -- per user decision
- Environment variable prefix: GSD_AUTOPILOT_ -- per user decision
- All config keys valid in all locations -- per research recommendation

**src/types/log.ts**:
- LogLevel: 'debug' | 'info' | 'warn' | 'error' | 'fatal'
- LogEntry: { timestamp, level, component, message, phase?, step?, meta? }

**src/types/notification.ts** -- Stub interfaces for later phases:
- NotificationSeverity: 'info' | 'warning' | 'critical'
- NotificationType: 'question' | 'progress' | 'error' | 'complete'
- Notification: { id, type, title, body, severity, respondUrl?, options?, phase?, step?, createdAt }
- NotificationAdapter interface: { name: string, send(notification: Notification): Promise<void> }

**src/types/index.ts** -- Barrel export re-exporting everything from state.ts, config.ts, log.ts, notification.ts using `export * from './state.js'` etc.

**src/index.ts** -- Package entry point re-exporting from types: `export * from './types/index.js'`

CRITICAL: Use `export type` for pure type exports when verbatimModuleSyntax is enabled. Use `export` (not `export type`) for the Zod schema since it's a runtime value. All imports between files use .js extensions.

After creating all files, run `npm run build` to verify everything compiles.
  </action>
  <verify>
Run from autopilot/ directory:
- `npm run build` exits with code 0
- `npm run typecheck` exits with code 0
- `node -e "import('./dist/index.js').then(m => console.log(Object.keys(m)))"` prints the exported names including AutopilotConfigSchema
- `node -e "import('./dist/types/index.js').then(m => { console.log('types:', Object.keys(m)) })"` shows all expected exports
  </verify>
  <done>
All type definition files exist and compile. AutopilotState, AutopilotConfig (with Zod schema), LogEntry, LogLevel, Notification, and NotificationAdapter are all importable from the package entry point. npm run build succeeds with zero errors.
  </done>
</task>

</tasks>

<verification>
1. `cd autopilot && npm run build` -- zero TypeScript errors, strict mode enabled
2. `node -e "import('./dist/index.js').then(m => console.log(Object.keys(m)))"` -- all types and schemas exported
3. Verify package.json has "type": "module" and engines.node >= 20
4. Verify tsconfig.json has "module": "NodeNext", "strict": true, "verbatimModuleSyntax": true
5. Grep for hardcoded path separators: `grep -rn "['\"].*[/\\\\].*['\"]" autopilot/src/` should find NO path construction (only import paths which use / correctly for ESM)
</verification>

<success_criteria>
- npm install, npm run build, and npm run typecheck all exit with code 0
- dist/ directory contains compiled .js, .d.ts files for all source modules
- All shared types are importable from '@gsd/autopilot' entry point
- Zod schema for config validates correctly at runtime
- No hardcoded path separators in any source file (FNDN-03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-types/01-01-SUMMARY.md`
</output>
